<!doctype html>
<html lang="EN-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

  <title>emscripten glfw test client</title>

  <style>
    body {
      margin: 0px;
    }

    canvas.emscripten {
      margin: 20px;
      border: 0px none;
      width: 315px;
      height: 210px;
      background-color: black;
      image-rendering: pixelated;
    }

    #canvas-details {
      display: flex;
    }

    .table-bordered {
      font-family: monospace;
      font-size: smaller;
    }

    .table-bordered>tbody>tr>td,
    .table-bordered>tbody>tr>th,
    .table-bordered>tfoot>tr>td,
    .table-bordered>tfoot>tr>th,
    .table-bordered>thead>tr>td,
    .table-bordered>thead>tr>th {
      border:1px solid #ddd
    }

    .table-bordered th, .table-bordered tr, .table-bordered td {
      padding: 0 12px;
    }

    .table-bordered tbody tr:nth-of-type(even) {
      background-color: #f3f3f3;
    }

    #debug {
      position: absolute;
      top: 0;
      right: 0;
    }
  </style>
</head>
<body>
<canvas class=emscripten id=canvas1 style="width: 285px; height: 190px;" oncontextmenu=event.preventDefault() tabindex=0></canvas>
<canvas class=emscripten id=canvas2 oncontextmenu=event.preventDefault() tabindex=0></canvas>
<div id="canvas-details">
  <table class="table-bordered">
    <thead>
    <tr><th>glfw (direct)</th><th>#1 (<a id="canvas1-enable-action" href=""></a>)</th><th>#2 (<a id="canvas2-enable-action" href=""></a>)</th></tr>
    </thead>
    <tbody>
    <tr class="glfwGetCursorPos"><td>glfwGetCursorPos</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetMouseButton"><td>glfwGetMouseButton</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetKey"><td>glfwGetKey</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowSize"><td>glfwGetWindowSize</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetFramebufferSize"><td>glfwGetFramebufferSize</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwGetWindowContentScale"><td>glfwGetWindowContentScale</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    </tbody>
  </table>
  <table class="table-bordered">
    <thead>
    <tr><th>glfw (callbacks)</th><th>#1</th><th>#2</th></tr>
    </thead>
    <tbody>
    <tr class="glfwSetCursorPosCallback"><td>glfwSetCursorPosCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetMouseButtonCallback"><td>glfwSetMouseButtonCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetKeyCallback"><td>glfwSetKeyCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetCharCallback"><td>glfwSetCharCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetWindowSizeCallback"><td>glfwSetWindowSizeCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetFramebufferSizeCallback"><td>glfwSetFramebufferSizeCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetWindowFocusCallback"><td>glfwSetWindowFocusCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    <tr class="glfwSetWindowContentScaleCallback"><td>glfwSetWindowContentScaleCallback</td><td class="canvas1">-</td><td class="canvas2">-</td></tr>
    </tbody>
  </table>
</div>
<table id="debug" class="table-bordered">
  <tbody>
  </tbody>
</table>
<p>
<ul>
  <li><label>Change focus: <input type="text"></label></li>
  <li><a id="exit" href="#">exit</a> </li>
</ul>
</p>

<script>

  var isCanvasEnabled = (name) => {
    const urlParams = new URLSearchParams(window.location.search);
    if(urlParams.has(name))
      return urlParams.get(name) !== "disabled";
    else
      return true;
  }

  var Module = {
    canvas: (function() {
      return document.getElementById('canvas1');
    })(),
    canvas1Enabled: isCanvasEnabled("canvas1"),
    canvas2Enabled: isCanvasEnabled("canvas2"),
    terminated: false,
  };

  var debug = (key, message) => {
    var elt = document.querySelector("#debug ." + key.toString());
    if(!elt)
    {
      const row = document.createElement("tr");
      const keyCell = document.createElement("td");
      keyCell.innerHTML = key.toString();
      row.appendChild(keyCell);
      elt = document.createElement("td");
      elt.className = key;
      row.appendChild(elt);
      document.querySelector("#debug tbody").appendChild(row);
    }
    elt.innerHTML = message.toString();
  };

  window.onresize = (event) => {
    debug("window-onresize-innerWidth", window.innerWidth);
    debug("window-onresize-innerHeight", window.innerHeight);
  };

  window.onscroll = (event) => {
    debug("window-onscroll-scrollX", window.scrollX);
    debug("window-onscroll-scrollY", window.scrollY);
  }

  document.onkeydown = (e) => {
    debug("document-onkeydown", e.code + "|" + e.keyCode + "|" + e.key + "|" + e.key.charCodeAt(0));
  }

  document.getElementById('exit').onclick = (event) => {
    event.preventDefault();
    Module.terminated = true;
  }

  const c1EnableAction = document.getElementById('canvas1-enable-action');
  c1EnableAction.href = (Module.canvas1Enabled ? "?canvas1=disabled" : "?canvas1=enabled")
    + "&canvas2=" + (Module.canvas2Enabled ? "enabled" : "disabled");
  c1EnableAction.innerHTML = Module.canvas1Enabled ? "disable" : "enable"

  const c2EnableAction = document.getElementById('canvas2-enable-action');
  c2EnableAction.href = (Module.canvas2Enabled ? "?canvas2=disabled" : "?canvas2=enabled")
    + "&canvas1=" + (Module.canvas1Enabled ? "enabled" : "disabled");
  c2EnableAction.innerHTML = Module.canvas2Enabled ? "disable" : "enable"

</script>
{{{ SCRIPT }}}
</body>
</html>
